<html><head><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/image.min.css"></head><body><div class="container"><div class="row"><div class="col-md-10 col-md-offset-1 ui image"><p class="lead"><p>In June 1846, Dr Semmelweis ordered everyone on his medical staff to start cleaning their hands and instruments not just with soap and water but with a chlorine solution (he didn't know it at the time, but chlorine is an amazing disinfectant). The reason Dr Semmelweis actually chose the chlorine was that he wanted to get rid of any smell on doctors' hands after an autopsy. No one knew anything about bacteria, germs or viruses at the time. </p><p><br></p><h4>Challenge 1: The Effect of Handwashing</h4><ul><li><p>Add a column called "pct_deaths" to <code>df_monthly</code> that has the percentage of deaths per birth for each row.</p></li><li><p>Create two subsets from the <code>df_monthly</code> data: before and after Dr Semmelweis ordered washing hand.</p></li><li><p>Calculate the average death rate prior to June 1846.</p></li><li><p>Calculate the average death rate after June 1846.</p></li></ul><p><br></p><h4>Challenge 2: Calculate a Rolling Average of the Death Rate</h4><p>Create a DataFrame that has the 6-month rolling average death rate prior to mandatory handwashing.</p><p><em>Hint</em>: You'll need to set the dates as the index in order to avoid the date column being dropped during the calculation</p><p><br></p><h4>Challenge 3:&nbsp;Highlighting Subsections of a Line Chart</h4><p>Copy-paste and then modify the Matplotlib chart from before to plot the monthly death rates (instead of the total number of births and deaths). The chart should look something like this:</p><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-23_12-27-28-063144e4acbc37b96bfd66f6f25f75f3.png"></figure><p><br></p><ul><li><p>Add 3 separate lines to the plot: the death rate before handwashing, after handwashing, and the 6-month moving average before handwashing.</p></li><li><p>Show the monthly death rate before handwashing as a thin dashed black line.</p></li><li><p>Show the moving average as a thicker, crimson line.</p></li><li><p>Show the rate after handwashing as a skyblue line with round markers.</p></li><li><p>Look at the <a href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.legend.html" rel="noopener noreferrer" target="_blank">code snippet in the documentation to see how you can add a legend</a> to the chart.</p></li></ul><p><br></p><p><br></p><p>.</p><p>.</p><p>..</p><p>...</p><p>..</p><p>.</p><p>.</p><p><br></p><p><strong>Solution to Challenge 1</strong></p><p>We can add a column with the proportion of deaths per birth like so:</p><pre class="prettyprint linenums">df_monthly['pct_deaths'] = df_monthly.deaths/df_monthly.births</pre><p>Then we can create two subsets based on the <code>handwashing_start</code> date. </p><pre class="prettyprint linenums">before_washing = df_monthly[df_monthly.date &lt; handwashing_start]<br>after_washing = df_monthly[df_monthly.date &gt;= handwashing_start]</pre><p>The death rate per birth dropped dramatically after handwashing started - from close to 10.53% to 2.15%. We can use the colon and dot inside a print statement to determine the number of digits we'd like to print out from a number. </p><pre class="prettyprint linenums">bw_rate = before_washing.deaths.sum() / before_washing.births.sum() * 100<br>aw_rate = after_washing.deaths.sum() / after_washing.births.sum() * 100<br>print(f'Average death rate before 1847 was {bw_rate:.4}%')<br>print(f'Average death rate AFTER 1847 was {aw_rate:.3}%')</pre><p><br></p><p><strong>Solution to Challenge 2</strong></p><p>To work out the moving 6-month average we first set the date column as the index. Then we can use the same Pandas functions as in the Google Trends notebook. </p><pre class="prettyprint linenums">roll_df = before_washing.set_index('date')<br>roll_df = roll_df.rolling(window=6).mean()</pre><p><br></p><p><strong>Solution to Challenge 3</strong></p><p>After copy-pasting the previous code for the Matplotlib chart, we just need to change a few things. First, we remove the twin axes. And instead, we plot the three different lines on the same axis. To create the legend, we supply a label to the <code>.plot()</code> function and capture return value in a variable. It's important to notice that <code>.plot()</code> returns more than one thing, so we need to use a comma (<code>,</code>) since we're only grabbing the first item. We can then feed these handles into <code>plt.legend()</code>. </p><pre class="prettyprint linenums">plt.figure(figsize=(14,8), dpi=200)<br>plt.title('Percentage of Monthly Deaths over Time', fontsize=18)<br>plt.yticks(fontsize=14)<br>plt.xticks(fontsize=14, rotation=45)<br>plt.ylabel('Percentage of Deaths', color='crimson', fontsize=18)<br>ax = plt.gca()<br>ax.xaxis.set_major_locator(years)<br>ax.xaxis.set_major_formatter(years_fmt)<br>ax.xaxis.set_minor_locator(months)<br>ax.set_xlim([df_monthly.date.min(), df_monthly.date.max()])<br>plt.grid(color='grey', linestyle='--')<br>ma_line, = plt.plot(roll_df.index, <br>                    roll_df.pct_deaths, <br>                    color='crimson', <br>                    linewidth=3, <br>                    linestyle='--',<br>                    label='6m Moving Average')<br>bw_line, = plt.plot(before_washing.date, <br>                    before_washing.pct_deaths,<br>                    color='black', <br>                    linewidth=1, <br>                    linestyle='--', <br>                    label='Before Handwashing')<br>aw_line, = plt.plot(after_washing.date, <br>                    after_washing.pct_deaths, <br>                    color='skyblue', <br>                    linewidth=3, <br>                    marker='o',<br>                    label='After Handwashing')<br>plt.legend(handles=[ma_line, bw_line, aw_line],<br>           fontsize=18)<br>plt.show()</pre><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-23_12-26-50-27dd134e94624962bdb420ddb176e825.png"></figure></p></div></div></div></body></html>