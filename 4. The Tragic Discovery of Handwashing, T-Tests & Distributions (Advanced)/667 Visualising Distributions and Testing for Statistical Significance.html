<html><head><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/image.min.css"></head><body><div class="container"><div class="row"><div class="col-md-10 col-md-offset-1 ui image"><p class="lead"><p>There are even more powerful arguments we can make to convince our fellow doctors in clinic 1 of the virtues of handwashing. The first are statistics regarding the mean monthly death rate. The second are compelling visualisations to accompany the statistics.</p><h4>Challenge 1:&nbsp;Calculate the Difference in the Average Monthly Death Rate</h4><ul><li><p>What was the average percentage of monthly deaths before handwashing (i.e., before June 1847)?</p></li><li><p>What was the average percentage of monthly deaths after handwashing was made obligatory?</p></li><li><p>By how much did handwashing reduce the average chance of dying in childbirth in percentage terms?</p></li><li><p>How do these numbers compare to the average for all the 1840s that we calculated earlier?</p></li><li><p>How many times lower are the chances of dying after handwashing compared to before?</p></li></ul><p><br></p><p>.</p><p>.</p><p>..</p><p>...</p><p>..</p><p>.</p><p>.</p><p><br></p><p><strong>Solution to Challenge 1</strong></p><p>A lot of statistical tests rely on comparing features of distributions, like the mean. We see that the average death rate before handwashing was 10.5%. After handwashing was made obligatory, the average death rate was 2.11%. The difference is massive. Handwashing decreased the average death rate by 8.4%, a 5x improvement. üòÆ</p><pre class="prettyprint linenums">avg_prob_before = before_washing.pct_deaths.mean() * 100<br>print(f'Chance of death during childbirth before handwashing: {avg_prob_before:.3}%.')<br>avg_prob_after = after_washing.pct_deaths.mean() * 100<br>print(f'Chance of death during childbirth AFTER handwashing: {avg_prob_after:.3}%.')<br>mean_diff = avg_prob_before - avg_prob_after<br>print(f'Handwashing reduced the monthly proportion of deaths by {mean_diff:.3}%!')<br>times = avg_prob_before / avg_prob_after<br>print(f'This is a {times:.2}x improvement!')</pre><p><br></p><h4>Challenge 2: Using Box Plots to Show How the Death Rate Changed Before and After Handwashing</h4><p>The statistic above is impressive, but how do we show it graphically?&nbsp;With a box plot we can show how the quartiles, minimum, and maximum values changed in addition to the mean. </p><ul><li><p>Use <a href="https://numpy.org/doc/stable/reference/generated/numpy.where.html" rel="noopener noreferrer" target="_blank">NumPy's <code>.where()</code> function</a> to add a column to <code>df_monthly</code> that shows if a particular date was before or after the start of handwashing.</p></li><li><p>Then use plotly to create box plot of the data before and after handwashing.</p></li><li><p>How did key statistics like the mean, max, min, 1st and 3rd quartile changed as a result of the new policy</p></li></ul><p><br></p><p>.</p><p>.</p><p>..</p><p>...</p><p>..</p><p>.</p><p>.</p><p><br></p><p><strong>Solution to Challenge 2</strong></p><p>The easiest way to create a box plot is to have a column in our DataFrame that shows the rows' "category" (i.e., was it before or after obligatory handwashing). NumPy allows us to easily test for a condition and add a column of data.</p><pre class="prettyprint linenums">df_monthly['washing_hands'] = np.where(df_monthly.date &lt; handwashing_start, 'No', 'Yes')</pre><p>Now we can use plotly:</p><pre class="prettyprint linenums">box = px.box(df_monthly, <br>             x='washing_hands', <br>             y='pct_deaths',<br>             color='washing_hands',<br>             title='How Have the Stats Changed with Handwashing?')<br>box.update_layout(xaxis_title='Washing Hands?',<br>                  yaxis_title='Percentage of Monthly Deaths',)<br>box.show()</pre><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-23_14-39-42-eb859925d7e636d7244c6b410bad919b.png"></figure><p>The plot shows us the same data as our Matplotlib chart, but from a different perspective. Here we also see the massive spike in deaths in late 1842. Over 30%&nbsp;of women who gave birth that month died in hospital. What we also see in the box plot is how not only did the average death rate come down, but so did the overall range - we have a lower max and 3rd quartile too. Let's take a look at a histogram to get a better sense of the distribution.</p><p><br></p><h4>Challenge 3: Use Histograms to Visualise the Monthly Distribution of Outcomes</h4><p>Create a <a href="https://plotly.com/python/histograms/" rel="noopener noreferrer" target="_blank">plotly histogram</a> to show the monthly percentage of deaths.</p><ul><li><p>Use docs to check out the available parameters. Use the <a href="https://plotly.github.io/plotly.py-docs/generated/plotly.express.histogram.html" rel="noopener noreferrer" target="_blank"><code>color</code> parameter</a> to display two overlapping histograms.</p></li><li><p>The time period of handwashing is shorter than not handwashing. Change <code>histnorm</code> to <code>percent</code> to make the time periods comparable.</p></li><li><p>Make the histograms slightly transparent</p></li><li><p>Experiment with the number of bins on the histogram. Which number works well in communicating the range of outcomes?</p></li><li><p>Just for fun, display your box plot on the top of the histogram using the <code>marginal</code> parameter</p></li></ul><p><br></p><p><br></p><p>.</p><p>.</p><p>..</p><p>...</p><p>..</p><p>.</p><p>.</p><p><br></p><p><strong>Solution to Challenge 3</strong></p><p>To create our histogram, we once again make use of the color parameter. This creates two separate histograms for us. When we set the opacity to 0.6 or so we can clearly see how the histograms overlap. The trick to getting a sensible-looking histogram when you have a very different number of observations is to set the <code>histnorm</code> to 'percent'. That way the histogram with more observations won't completely overshadow the shorter series.</p><pre class="prettyprint linenums">hist = px.histogram(df_monthly, <br>                   x='pct_deaths', <br>                   color='washing_hands',<br>                   nbins=30,<br>                   opacity=0.6,<br>                   barmode='overlay',<br>                   histnorm='percent',<br>                   marginal='box',)<br>hist.update_layout(xaxis_title='Proportion of Monthly Deaths',<br>                   yaxis_title='Count',)<br>hist.show()</pre><p>I&nbsp;quite like how in plotly we can display our box plot from earlier at the top. </p><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-23_14-49-58-3961b13cff88b2866bba7da183716a04.png"></figure><p>Now, we have only about 98 data points or so, so our histogram looks a bit jagged. It's not a smooth bell-shaped curve. However, we can estimate what the distribution would look like with a Kernel Density Estimate (KDE).</p><p><br></p><h4>Challenge 4: Use a Kernel Density Estimate (KDE) to visualise a smooth distribution</h4><p>Use <a href="https://seaborn.pydata.org/generated/seaborn.kdeplot.html" rel="noopener noreferrer" target="_blank">Seaborn's <code>.kdeplot()</code></a> to create two kernel density estimates of the pct_deaths, one for before handwashing and one for after.</p><ul><li><p>Use the <code>shade</code> parameter to give your two distributions different colours.</p></li><li><p>What weakness in the chart do you see when you just use the default parameters?</p></li><li><p>Use the <code>clip</code> parameter to address the problem.</p></li></ul><p><br></p><p>.</p><p>.</p><p>..</p><p>...</p><p>..</p><p>.</p><p>.</p><p><br></p><p><strong>Solution to Challenge 4</strong></p><p>To create two bell-shaped curves of the estimated distributions of the death rates we just call <code>.kdeplot()</code> twice. </p><pre class="prettyprint linenums">plt.figure(dpi=200)<br># By default the distribution estimate includes a negative death rate!<br>sns.kdeplot(before_washing.pct_deaths, shade=True)<br>sns.kdeplot(after_washing.pct_deaths, shade=True)<br>plt.title('Est. Distribution of Monthly Death Rate Before and After Handwashing')<br>plt.show()</pre><p>However, the problem is that we end up with a negative monthly death rate on the left tail. The doctors would be very surprised indeed if a corpse came back to life after an autopsy! üßü‚Äç‚ôÄÔ∏è </p><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-23_14-59-53-0b2eb0809a34c6eb94983086e631800c.png"></figure><p>The solution is to specify a lower bound of 0 for the death rate. </p><pre class="prettyprint linenums">plt.figure(dpi=200)<br>sns.kdeplot(before_washing.pct_deaths, <br>            shade=True,<br>            clip=(0,1))<br>sns.kdeplot(after_washing.pct_deaths, <br>            shade=True,<br>            clip=(0,1))<br>plt.title('Est. Distribution of Monthly Death Rate Before and After Handwashing')<br>plt.xlim(0, 0.40)<br>plt.show()</pre><figure><img src="https://img-c.udemycdn.com/redactor/raw/2020-10-23_15-00-50-d951f463f0f6b86e096672a3d6a05e77.png"></figure><p>Now that we have an idea of what the two distributions look like, we can further strengthen our argument for handwashing by using a statistical test. We can test whether our distributions ended up looking so different purely by chance (i.e., the lower death rate is just an accident) or if the 8.4% difference in the average death rate is <strong>statistically significant</strong>. </p><p><br></p><p><br></p><h4>Challenge 5: Use a T-Test to Show Statistical Significance</h4><p>Use a t-test to determine if the differences in the means are statistically significant or purely due to chance.</p><p>If the p-value is less than 1% then we can be 99% certain that handwashing has made a difference to the average monthly death rate.</p><ul><li><p>Import <code>stats</code> from scipy</p></li><li><p>Use the <a href="https://docs.scipy.org/%5Ddoc/scipy/reference/generated/scipy.stats.ttest_ind.html" rel="noopener noreferrer" target="_blank"><code>.ttest_ind()</code> function</a> to calculate the t-statistic and the p-value</p></li><li><p>Is the difference in the average proportion of monthly deaths statistically significant at the 99% level?</p></li></ul><p><br></p><p>.</p><p>.</p><p>..</p><p>...</p><p>..</p><p>.</p><p>.</p><p><br></p><p><strong>Solution to Challenge 5</strong></p><p>The first step is to import stats from scipy</p><pre class="prettyprint linenums">import scipy.stats as stats</pre><p>When we calculate the p_value we see that it is 0.0000002985 or .00002985% which is far below even 1%. In other words, the difference in means is highly statistically significant and we can go ahead on publish our research paper üòä </p><pre class="prettyprint linenums">t_stat, p_value = stats.ttest_ind(a=before_washing.pct_deaths, <br>                                  b=after_washing.pct_deaths)<br>print(f'p-palue is {p_value:.10f}')<br>print(f't-statstic is {t_stat:.4}')</pre><p><br></p></p></div></div></div></body></html>